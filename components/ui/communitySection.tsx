"use client";
import { useEffect, useRef } from "react";
import gsap from "gsap";
import { ScrollTrigger } from "gsap/ScrollTrigger";

gsap.registerPlugin(ScrollTrigger);

export default function CommunitySection() {
  const spinContainerRef = useRef<HTMLDivElement>(null);
  const communityTextRef = useRef<SVGSVGElement>(null);
  const butterTextRef = useRef<SVGSVGElement>(null);
  const playButtonRef = useRef<SVGSVGElement>(null);
  const avatar1Ref = useRef<HTMLImageElement>(null);
  const avatar2Ref = useRef<HTMLImageElement>(null);
  const avatar3Ref = useRef<HTMLImageElement>(null);

  useEffect(() => {
    if (!spinContainerRef.current) return;

    const ctx = gsap.context(() => {
      // Community text animation - fade in and rotate
      if (communityTextRef.current) {
        gsap.fromTo(
          communityTextRef.current,
          {
            opacity: 0,
            rotation: -180,
            scale: 0.5,
          },
          {
            opacity: 1,
            rotation: 0,
            scale: 1,
            duration: 1.5,
            ease: "power3.out",
            scrollTrigger: {
              trigger: spinContainerRef.current,
              start: "top 70%",
              end: "top 30%",
              scrub: 1,
            },
          }
        );

        // Continuous rotation on scroll
        gsap.to(communityTextRef.current, {
          rotation: 360,
          ease: "none",
          scrollTrigger: {
            trigger: spinContainerRef.current,
            start: "top bottom",
            end: "bottom top",
            scrub: 2,
          },
        });
      }

      // Butter text animation - fade in and counter-rotate
      if (butterTextRef.current) {
        gsap.fromTo(
          butterTextRef.current,
          {
            opacity: 0,
            rotation: 180,
            scale: 0.5,
          },
          {
            opacity: 1,
            rotation: 0,
            scale: 1,
            duration: 1.5,
            ease: "power3.out",
            scrollTrigger: {
              trigger: spinContainerRef.current,
              start: "top 70%",
              end: "top 30%",
              scrub: 1,
            },
          }
        );

        // Continuous counter-rotation
        gsap.to(butterTextRef.current, {
          rotation: -360,
          ease: "none",
          scrollTrigger: {
            trigger: spinContainerRef.current,
            start: "top bottom",
            end: "bottom top",
            scrub: 2,
          },
        });
      }

      // Play button fade in
      if (playButtonRef.current) {
        gsap.fromTo(
          playButtonRef.current,
          {
            opacity: 0,
            scale: 0,
          },
          {
            opacity: 1,
            scale: 1,
            duration: 0.8,
            ease: "back.out(1.7)",
            scrollTrigger: {
              trigger: spinContainerRef.current,
              start: "top 60%",
            },
          }
        );
      }

      // Avatar animations with stagger
      const avatars = [
        avatar1Ref.current,
        avatar2Ref.current,
        avatar3Ref.current,
      ];
      avatars.forEach((avatar, index) => {
        if (avatar) {
          gsap.fromTo(
            avatar,
            {
              opacity: 0,
              scale: 0,
              rotation: -360,
            },
            {
              opacity: 1,
              scale: 1,
              rotation: 0,
              duration: 1,
              ease: "back.out(1.7)",
              scrollTrigger: {
                trigger: spinContainerRef.current,
                start: "top 70%",
              },
              delay: index * 0.2,
            }
          );
        }
      });
    }, spinContainerRef);

    return () => ctx.revert();
  }, []);

  return (
    <section className="bg-white px-4 sm:px-6 lg:px-[190px] flex justify-center items-center ">
      <div
        ref={spinContainerRef}
        className="relative w-full max-w-[1060px] aspect-square flex items-center justify-center"
      >
        {/* Community text - outer spinning circle */}
        <svg
          ref={communityTextRef}
          className="absolute w-full h-full"
          style={{ transform: "rotate(-112.545deg)" }}
          viewBox="0 0 1375 1337"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <g clipPath="url(#clip0_community)">
            <path
              d="M841.312 1164.06C828.013 1163.07 815.305 1158.31 804.703 1150.33C793.918 1142.31 785.647 1131 779.887 1116.41C774.128 1101.82 772.431 1087.91 774.793 1074.67C777.084 1061.61 783.1 1049.44 792.127 1039.63C801.826 1029.16 813.842 1021.07 827.214 1016.02C846.505 1008.4 865.338 1006.7 883.715 1010.91L876.639 1050.17C870.883 1048.78 864.968 1048.11 859.035 1048.19C853.423 1048.4 847.886 1049.6 842.677 1051.72C836.144 1054.21 830.241 1058.11 825.394 1063.14C820.846 1067.89 817.785 1073.85 816.586 1080.28C815.371 1087.26 816.204 1094.42 818.986 1100.91C821.405 1107.55 825.694 1113.35 831.347 1117.62C836.624 1121.49 842.931 1123.74 849.498 1124.1C856.467 1124.45 863.44 1123.26 869.906 1120.6C875.158 1118.6 880.017 1115.69 884.261 1112.02C888.645 1108.01 892.507 1103.48 895.756 1098.53L927.767 1122.35C917.243 1138 902.333 1149.63 883.038 1157.24C869.834 1162.71 855.544 1165.05 841.312 1164.06Z"
              fill="black"
            />
            <path
              d="M1108.98 957.096C1101.56 962.314 1092.8 965.316 1083.74 965.747C1074.2 966.079 1064.78 963.772 1056.53 959.086C1048.07 954.777 1040.99 948.216 1036.08 940.131C1031.53 932.377 1029.31 923.476 1029.68 914.478C1030.15 904.53 1033 894.819 1037.99 886.151C1042.62 877.292 1049.31 869.647 1057.49 863.849C1064.92 858.639 1073.68 855.637 1082.74 855.199C1092.27 854.873 1101.69 857.179 1109.95 861.86C1118.43 866.15 1125.53 872.705 1130.45 880.792C1135.01 888.545 1137.23 897.446 1136.85 906.445C1136.39 916.393 1133.55 926.108 1128.57 934.78C1123.91 943.649 1117.2 951.301 1108.98 957.096ZM1101.17 904.834C1100.58 902.498 1099.48 900.319 1097.96 898.451C1096.44 896.583 1094.52 895.071 1092.34 894.017C1090.26 892.778 1087.93 892.006 1085.52 891.754C1083.1 891.504 1080.65 891.779 1078.35 892.561C1073.69 894.283 1069.86 897.703 1067.63 902.121C1065.09 906.373 1064.27 911.419 1065.36 916.223C1065.94 918.563 1067.03 920.745 1068.56 922.614C1070.09 924.482 1072.01 925.991 1074.2 927.034C1076.27 928.271 1078.6 929.043 1081.01 929.296C1083.43 929.549 1085.87 929.276 1088.17 928.497C1092.84 926.778 1096.68 923.355 1098.91 918.931C1101.45 914.662 1102.26 909.594 1101.14 904.779L1101.17 904.834Z"
              fill="black"
            />
            <path
              d="M1192.26 642.707L1098.82 668.942L1088.86 633.045L1103.62 628.893L1103.47 628.516C1097.12 627.328 1091.28 624.308 1086.67 619.832C1082.13 615.218 1078.88 609.5 1077.25 603.24C1074.97 595.099 1074.99 588.014 1077.33 581.984C1079.59 576 1083.55 570.79 1088.74 566.992L1088.59 566.616C1081.63 565.403 1075.16 562.329 1069.86 557.723C1064.77 552.836 1061.18 546.613 1059.5 539.77C1056.49 528.939 1057.32 519.77 1061.98 512.261C1066.65 504.753 1074.84 499.352 1086.58 496.06L1146.67 479.274L1156.98 516.215L1109.45 529.564C1098 532.784 1093.4 538.47 1095.66 546.618C1098.43 556.507 1106.01 559.71 1118.41 556.227L1164.52 543.29L1174.37 578.562L1126.84 591.907C1115.39 595.128 1110.79 600.813 1113.05 608.962C1115.82 618.851 1123.4 622.053 1135.8 618.57L1181.93 605.625L1192.26 642.707Z"
              fill="black"
            />
            <path
              d="M976.354 279.709L935.169 367.137L901.178 351.535L907.689 337.715L907.306 337.547C902.237 341.573 896.096 344.031 889.651 344.615C883.143 345.074 876.637 343.835 870.783 341.02C863.065 337.466 857.646 332.869 854.525 327.232C851.436 321.659 850.052 315.301 850.54 308.936L850.172 308.763C844.684 313.225 838.087 316.127 831.088 317.158C824.013 317.843 816.902 316.528 810.573 313.365C800.31 308.658 793.833 302.095 791.141 293.679C788.449 285.262 789.693 275.593 794.874 264.67L821.347 208.474L856.483 224.613L835.542 269.075C830.477 279.799 831.792 286.941 839.492 290.504C848.863 294.809 856.282 291.158 861.75 279.549L882.068 236.407L915.492 251.754L894.556 296.231C889.49 306.954 890.807 314.096 898.506 317.659C907.876 321.964 915.295 318.314 920.763 306.705L941.082 263.562L976.354 279.709Z"
              fill="black"
            />
            <path
              d="M567.306 219.816C575.971 223.928 582.26 231.695 586.178 243.117L606.24 301.61L568.039 313.191L551.678 265.521C549.932 260.401 547.484 256.928 544.347 255.129C542.805 254.24 541.087 253.691 539.31 253.517C537.531 253.343 535.733 253.549 534.036 254.119C524.797 256.932 522.455 264.978 527.012 278.259L541.741 321.203L504.55 332.479L473.363 241.469L509.353 230.556L514.154 244.544L514.534 244.387C516.263 238.212 519.336 232.475 523.535 227.592C527.65 223.209 532.902 220.033 538.709 218.434C549.095 215.206 558.627 215.666 567.306 219.816Z"
              fill="black"
            />
            <path
              d="M310.099 526.124C301.085 528.235 291.084 526.024 280.098 519.495L227.947 488.739L247.915 455.553L290.893 480.893C295.816 483.801 300.051 485.003 303.601 484.499C307.148 483.989 310.111 481.796 312.484 477.823C317.807 468.964 314.714 461.143 303.206 454.362L262.911 430.603L282.88 397.416L365.977 446.409L346.654 478.528L334.236 471.21L334.025 471.574C336.703 477.596 338.011 484.136 337.856 490.734C337.479 497.211 335.455 503.499 331.976 509.011C326.373 518.335 319.081 524.039 310.099 526.124Z"
              fill="black"
            />
            <path
              d="M329.039 735.392C327.171 737.563 324.873 739.327 322.289 740.574C319.704 741.822 316.892 742.524 314.028 742.635C311.188 742.874 308.334 742.532 305.641 741.631C302.947 740.73 300.473 739.29 298.369 737.398C296.211 735.563 294.459 733.304 293.223 730.761C291.986 728.22 291.29 725.448 291.178 722.62C290.937 719.786 291.288 716.929 292.214 714.23C293.138 711.53 294.617 709.047 296.554 706.937C298.435 704.812 300.727 703.084 303.291 701.858C305.855 700.63 308.639 699.929 311.476 699.796C314.323 699.538 317.19 699.861 319.901 700.743C322.611 701.624 325.107 703.048 327.238 704.926C329.38 706.79 331.113 709.072 332.332 711.632C333.55 714.192 334.228 716.974 334.325 719.811C334.548 722.62 334.195 725.45 333.286 728.128C332.378 730.807 330.933 733.278 329.039 735.392ZM280.177 703.941L282.475 742.397L185.707 748.709L183.423 710.247L280.177 703.941Z"
              fill="black"
            />
            <path
              d="M348.337 977.653L336.673 960.912L323.715 969.884C319.462 972.824 316.963 975.38 316.27 977.562C315.576 979.744 316.344 982.428 318.672 985.772L320.568 988.511L290.849 1009.01L281.919 996.196C268.024 976.28 271.501 959.109 292.351 944.685L314.639 929.278L303.579 913.397L329.833 895.233L340.893 911.114L372.92 888.987L394.966 920.649L362.945 942.79L374.603 959.516L348.337 977.653Z"
              fill="black"
            />
            <path
              d="M540.881 1122.95L577.703 1085.88L613.641 1097.84L505.614 1207.67L468.891 1195.46L509.804 1154.23L495.914 1058.66L536.805 1072.27L540.881 1122.95Z"
              fill="black"
            />
          </g>
          <defs>
            <clipPath id="clip0_community">
              <rect
                width="1060"
                height="1060"
                fill="white"
                transform="translate(406.76 1381.01) rotate(-112.545)"
              />
            </clipPath>
          </defs>
        </svg>

        {/* Butter text - inner spinning circle */}
        <svg
          ref={butterTextRef}
          className="absolute"
          style={{
            width: "51%",
            height: "46.4%",
            transform: "rotate(118.494deg)",
          }}
          viewBox="0 0 691 711"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <g clipPath="url(#clip0_butter)">
            <path
              d="M557.356 284.077C563.214 303.673 557.16 317.84 539.192 326.579C526.21 332.902 514.612 333.195 504.399 327.457C494.187 321.719 485.548 311.754 478.485 297.562L449.725 239.77L580.813 176.054L609.47 233.653C615.984 246.737 618.481 258.296 616.961 268.332C615.442 278.367 608.997 286.145 597.626 291.665C590.144 295.304 583.132 296.392 576.589 294.928C570.046 293.463 563.757 289.782 557.721 283.881L557.356 284.077ZM569.097 225.872L546.625 236.808L554.622 252.888C556.233 256.645 559.057 259.768 562.645 261.76C565.813 263.308 569.352 263.154 573.264 261.296C577.014 259.481 579.119 256.876 579.645 253.551C580.042 249.529 579.178 245.474 577.17 241.941L569.097 225.872ZM504.993 277.47C507.732 282.962 510.796 286.644 514.225 288.539C517.654 290.435 521.611 290.307 526.09 288.136C530.569 285.964 532.913 283.078 533.458 279.336C534.003 275.593 532.855 270.898 530.072 265.297L521.868 248.866L496.775 261.066L504.993 277.47Z"
              fill="black"
            />
            <path
              d="M486.428 421.81C495.803 421.091 505.023 424.785 514.09 432.889L560.465 474.336L534.048 503.648L496.254 469.853C492.191 466.228 488.394 464.407 484.828 464.387C483.062 464.378 481.318 464.756 479.722 465.496C478.126 466.235 476.716 467.318 475.594 468.666C469.194 475.767 471.253 484.015 481.774 493.41L515.802 523.86L490.087 552.389L417.952 487.924L442.818 460.354L453.908 470.259L454.195 469.953C452.526 463.637 452.214 457.053 453.279 450.633C454.523 444.757 457.36 439.345 461.482 434.979C468.72 426.908 477.036 422.517 486.428 421.81Z"
              fill="black"
            />
            <path
              d="M262.606 546.959L282.567 551.566L286.018 536.328C287.156 531.333 287.202 527.781 286.272 525.736C285.343 523.692 282.852 522.169 278.905 521.259L275.632 520.509L283.505 485.665L298.853 489.223C322.662 494.72 331.814 509.692 326.307 534.138L320.41 560.284L339.366 564.704L332.414 595.496L313.436 591.115L304.984 628.587L267.242 619.873L275.695 582.401L255.733 577.794L262.606 546.959Z"
              fill="black"
            />
            <path
              d="M136.203 394.277L144.057 413.17L158.525 407.334C163.301 405.409 166.241 403.463 167.391 401.504C168.541 399.544 168.281 396.682 166.825 392.999L165.546 389.91L198.76 376.471L204.744 390.91C214.097 413.406 207.121 429.366 183.816 438.791L158.902 448.88L166.349 466.801L136.993 478.672L129.546 460.752L93.8062 475.215L79.0293 439.507L114.748 425.05L106.895 406.156L136.203 394.277Z"
              fill="black"
            />
            <path
              d="M179.354 186.504C191.814 184.643 205.25 188.89 219.66 199.245L225.104 203.159L186.454 256.664C188.529 257.402 190.729 257.709 192.922 257.569C195.113 257.428 197.25 256.842 199.199 255.849C203.046 253.854 206.918 250.16 210.812 244.767C215.527 237.854 218.854 230.092 220.613 221.905L249.526 230.173C246.629 242.061 241.437 253.26 234.236 263.147C223.462 278.071 211.496 287.062 198.342 290.12C185.185 293.177 171.912 289.902 158.524 280.296C145.02 270.604 137.466 259.3 135.862 246.383C134.257 233.465 138.02 220.677 147.148 208.019C156.162 195.55 166.898 188.379 179.354 186.504ZM163.356 235.075C163.767 239.028 165.926 242.596 169.859 245.758L187.732 221.014C183.646 218.078 179.694 216.987 175.875 217.743C171.99 218.54 168.584 220.818 166.382 224.09C164.003 227.215 162.903 231.127 163.303 235.046L163.356 235.075Z"
              fill="black"
            />
            <path
              d="M396.523 112.447L394.356 148.557L392.062 148.39C382.461 147.742 375.349 149.277 370.727 152.997C366.105 156.717 363.483 163.763 362.863 174.139L360.753 209.219L322.146 206.622L327.889 110.732L365.245 113.248L364.191 131.105L364.604 131.141C367.99 123.716 372.277 118.628 377.468 115.879C383.212 112.983 389.682 111.788 396.116 112.432L396.523 112.447Z"
              fill="black"
            />
          </g>
          <defs>
            <clipPath id="clip0_butter">
              <rect
                width="540.593"
                height="491.72"
                fill="white"
                transform="translate(690.159 235.409) rotate(118.494)"
              />
            </clipPath>
          </defs>
        </svg>

        {/* Play button in center */}
        <svg
          ref={playButtonRef}
          className="absolute"
          style={{ width: "64px", height: "68px" }}
          viewBox="0 0 66 69"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <g clipPath="url(#clip0_play)">
            <path
              d="M2.22986 34.3184C2.22986 48.7693 3.18233 58.2701 3.89967 63.3763C4.27736 66.0648 6.59205 67.7401 9.1854 66.9369C13.6444 65.556 21.8505 62.2773 35.6809 54.4923C49.5181 46.7036 57.4789 41.1702 61.7289 37.892C64.1891 35.9944 64.2154 32.6128 61.7922 30.6679C57.3759 27.1236 49.1389 21.2463 35.6809 14.1445C23.102 7.50663 14.8504 4.07801 10.0465 2.35016C7.09235 1.28761 4.17676 3.1205 3.7675 6.23314C3.07085 11.5315 2.22986 20.7397 2.22986 34.3184Z"
              fill="#FFFD63"
              stroke="#0A0B1E"
              strokeWidth="2.005"
            />
          </g>
          <defs>
            <clipPath id="clip0_play">
              <rect
                width="64.16"
                height="68.17"
                fill="white"
                transform="translate(0.919922 0.695312)"
              />
            </clipPath>
          </defs>
        </svg>

        {/* Avatar images */}
        <img
          ref={avatar1Ref}
          src="https://api.builder.io/api/v1/image/assets/TEMP/f6b4859ee1dcaed4584664331edb2e43d5203340?width=216"
          alt="Community member"
          className="absolute w-[80px] sm:w-[108px] h-[80px] sm:h-[108px] rounded-full"
          style={{ left: "16%", top: "28%" }}
        />
        <img
          ref={avatar2Ref}
          src="https://api.builder.io/api/v1/image/assets/TEMP/68fc9539e8d3b9979c25c2538cc6d7b1aa64f976?width=210"
          alt="Community member"
          className="absolute w-[75px] sm:w-[105px] h-[75px] sm:h-[105px] rounded-full"
          style={{ right: "16%", top: "36%" }}
        />
        <img
          ref={avatar3Ref}
          src="https://api.builder.io/api/v1/image/assets/TEMP/d6e5ae7769b03a82e058707e5294014b6f7a9f60?width=204"
          alt="Community member"
          className="absolute w-[75px] sm:w-[102px] h-[75px] sm:h-[102px] rounded-full"
          style={{ left: "34%", bottom: "16%" }}
        />
      </div>
    </section>
  );
}
